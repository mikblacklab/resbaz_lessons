---
title: "Creating packages in R"
author: "Mik Black"
date: "2 Feb 2016"
output: ioslides_presentation
---

## Before we start

 - There is a perfectly good Software Carpentry lesson on creating R packages, but we will not be using it:
 
 http://swcarpentry.github.io/r-novice-inflammation/08-making-packages-R.html

 - Why not?  Because I had already written some of my slides when Murray pointed out that I had re-invented the wheel.
 
   - I'm sure there is a ResBaz-related life-lesson in there somewhere...
 
 - I really just wanted a reason to show you Hilary's "cat cup".
 

## Attribution

<img src="https://hilaryparker.files.wordpress.com/2014/10/cropped-img_20140902_1804591.jpg" height="300">

Thanks to Hilary Parker ([\@hspter](https://twitter.com/hspter)) - code adapted from:

http://hilaryparker.com/2014/04/29/writing-an-r-package-from-scratch/


## Getting ready

 - To get started, we need to instal the `devtools` and `roxygen` packages.

```{r, eval=FALSE}
install.packages('devtools')
library("devtools")
devtools::install_github("klutometis/roxygen")
library(roxygen2)
```

```{r, echo=FALSE}
library(devtools)
library(roxygen2)
```

 - `devtools` (Hadley Wickham & Winston Chang): Tools to Make Developing R Packages Easier
 - `roxygen2` (Hadley Wickham, Peter Danenberg & Manuel Eugster):  In-source Documentation for R

## Setting up

 - Use the `create()` function from `devtools` to set up a basic package structure:

```{r, echo=FALSE}
system('rm -Rf cats')
## remove.packages('cats')
```

```{r}
create("cats")
```

## What did that do?

```{r}
list.files(path = "cats", recursive=TRUE, include.dirs=TRUE)
```

## Create a function

```{r}
cat_function <- function(love=TRUE){
    if(love==TRUE){
        print("I love cats!")
    }
    else {
        print("I am not a cool person.")
    }
}
```

## Try it out

```{r}
cat_function(love=TRUE)
cat_function(love=FALSE)
cat_function()
```

## Write the function to a file

```{r}
dump('cat_function', file='cats/R/cat_function.R')
```

## Add some extra info to it

```{r, eval=FALSE}
#' A Cat Function
#'
#' This function allows you to express your love of cats.
#' @param love Do you love cats? Defaults to TRUE.
#' @keywords cats
#' @export
#' @examples
#' cat_function()
```

```{r, echo=FALSE}

x<-c("#' A Cat Function",
     "#'",
     "#' This function allows you to express your love of cats.",
     "#' @param love Do you love cats? Defaults to TRUE.",
     "#' @keywords cats",
     "#' @export",
     "#' @examples",
     "#' cat_function()",
     "")
write(x, file='cats/R/cat_function.R')
dump('cat_function', file='cats/R/cat_function.R', append=TRUE)
```

## Process your documentation

```{r}
setwd("./cats")
document()
```

```{r, echo=FALSE}
rm('cat_function')
detach("package:cats", unload=TRUE)
```

## Install package

```{r, eval=FALSE}
setwd("..")
install("cats")
```

```{r, echo=FALSE}
install('cats')
```

## Test it out

Don't forget to load the library first...

```{r, error=TRUE}
cat_function()
```

```{r}
library(cats)
cat_function()
```

## Test your documentation

```{r}
?cat_function
```

## Install from Github repo

```{r, eval=FALSE}
install_github('mikblack/cats')
```


